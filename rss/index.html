<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[dorzey.net]]></title><description><![CDATA[My thoughts on AI, Machine Learning, Data and Analytics]]></description><link>http://www.dorzey.net/</link><image><url>http://www.dorzey.net/favicon.png</url><title>dorzey.net</title><link>http://www.dorzey.net/</link></image><generator>Ghost 5.100</generator><lastBuildDate>Tue, 12 Nov 2024 16:29:56 GMT</lastBuildDate><atom:link href="http://www.dorzey.net/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[How Miro migrated its analytics event tracking system]]></title><description><![CDATA[Learn how Miro migrated its analytics event system, Event Hub, to a new deployment without losing a single event or causing delays.]]></description><link>http://www.dorzey.net/2023/11/14/how-miro-migrated-its-analytics-event-tracking-system/</link><guid isPermaLink="false">6553eb97e5fbfa0001399de2</guid><category><![CDATA[Migration]]></category><category><![CDATA[Ways Of Working]]></category><category><![CDATA[Analytics]]></category><category><![CDATA[Big Data]]></category><dc:creator><![CDATA[Paul Doran]]></dc:creator><pubDate>Tue, 14 Nov 2023 21:56:41 GMT</pubDate><media:content url="http://www.dorzey.net/content/images/2023/11/birds.png" medium="image"/><content:encoded><![CDATA[<img src="http://www.dorzey.net/content/images/2023/11/birds.png" alt="How Miro migrated its analytics event tracking system"><p>In this post, we&#x2019;ll take you behind the scenes of how we migrated our analytics event system &#x2014; responsible for handling ~3.5 billion events per day &#x2014; without losing a single event. We&#x2019;ll go into the technical details and the strategy we used that allowed us to leverage Kubernetes, Kafka, Apache Spark, and Airflow to safeguard the events that power some of Miro&#x2019;s key business decisions.</p><h1 id="in-the-beginning-2017-2021">In the beginning: 2017&#x2013;2021</h1><p>By 2017 Miro had reached 1M users. In September of that year, Miro put its in-house analytics event tracking system, called Event Hub, into production. On its first day it received its first 1.5 million events. Event Hub consists of the following:</p><ul><li>A Spring Boot API that collects events from various backend and frontend clients; the events are written to a Kafka topic;</li><li>A Kafka that is used as a durable message broker;</li><li>An Apache Spark Data Pipeline, in Java, that runs once a day. It conforms the events into a common format, applies enrichments, and makes the events available for downstream use cases.</li></ul><p>The initial deployment of Event Hub was done as a raw deployment on EC2. Only some parts of the deployment were done as infrastructure-as-code, and it turned out to be remarkably stable with very few incidents.</p><h1 id="during-hypergrowth-2021-2022">During Hypergrowth: 2021&#x2013;2022</h1><p>During 2021&#x2013;2022, Miro experienced dramatic growth, reaching 30M registered users in 2021. In turn, our Event Hub instance was receiving around 2.5 billion events per day.</p><p>Miro also grew its data team during this time, which helped us improve our data capabilities. This led to the data pipeline being simplified, re-implemented in Scala Spark, migrated to Databricks, and being orchestrated via Airflow. This allowed the team to increase the frequency the pipeline ran to hourly. This allowed us to both provide fresher data to downstream analytics use cases and reduce our mean time to recover if there was a failure.</p><p>In this period, Miro also adopted Kubernetes and outlined a golden path for teams to deploy their services.</p><h1 id="decision-time-2023">Decision time: 2023</h1><p>By the beginning of 2023 we were processing around 3 billion events per day. At the same time, a few circumstances coincided which altogether led us to the decision of completing the migration:</p><ol><li>Event quality was beginning to suffer. This negatively impacted Miro&#x2019;s ability to make reliable data-informed decisions. At the beginning, Miro deliberately chose a permissive model for events, but once the organization scaled this became unsustainable. We wanted to introduce Event Validation to improve the quality, but this would have been risky to do on the existing infrastructure.</li><li>We were asked to bring the Event Hub deployment in line with Miro best practices and leverage all the internal tooling around Kubernetes, Istio, and Terraform.</li><li>While Event Hub had very few incidents during its lifespan, maintenance and upgrades were a delicate matter. It was now running on several EC2 instances. We knew that losing even just one of them would have meant hours of downtime. The number of moving parts was destined to increase with the growth in Miro users. And so was the probability of a catastrophic failure.</li></ol><h1 id="the-migration-2023">The migration: 2023</h1><p>We decided to migrate, but now we needed to understand how to make it happen.</p><p><em>&#x201C;Plans are of little importance, but planning is essential&#x201D; &#x2014; Winston Churchill.</em></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://miro.medium.com/v2/resize:fit:1400/1*-np_lSdG-TrSGGzrBkAZkw.png" class="kg-image" alt="How Miro migrated its analytics event tracking system" loading="lazy"><figcaption><em>Birds migrating</em></figcaption></figure><h2 id="1-define-the-plan">1. Define the plan</h2><p>We started the process knowing that we needed a plan. But we all agreed that we would not have all the knowledge we needed at the beginning, so we should be adaptable to changing the plan as we progressed. We had a regular sync on progress to understand if we needed to update the plan.</p><h2 id="2-create-infrastructure">2. Create infrastructure</h2><p>We needed somewhere to deploy Event Hub, so we first created the infrastructure needed for our deployment. We could reuse some parts of the existing infrastructure, like Kubernetes, but other parts, like Kafka, had to be created.</p><h2 id="3-observability">3. Observability</h2><p>The previous iteration of Event Hub had been running for years. The engineering team that cared lovingly for this system grew intimately familiar with its usage profile. But the significant design changes we were about to make were a source of uncertainty. Observability proved to be crucial to proceed with confidence. Luckily, a lot of instrumentation at the API Gateway, Kubernetes, and Infrastructure level was provided out of the box by Miro internal tooling. Moreover, the experience with the previous system informed us where to focus our attention first.</p><h2 id="4-migrate-event-hub-to-staging">4. Migrate Event Hub to staging</h2><p>Once we had the infrastructure necessary in the staging environment, we could deploy Event Hub to it. At this point we were able to go end to end. We could post an event into the API, move it through Kafka, and process it through the Spark Data Pipeline.</p><h2 id="5-load-test">5. Load test</h2><p>We were now running Event Hub in staging, but it was new infrastructure. We were unsure how it would perform, and if the infrastructure was correctly sized. Paired with the effort put toward observability highlighted above, we were able to run a load test that provided a realistic production volume of events. This required several iterations to correctly size the infrastructure to achieve the necessary performance. This also provided valuable insight into how we should define our auto-scaling policies.</p><h2 id="6-deploy-to-production">6. Deploy to production</h2><p>We were now confident that we could deploy Event Hub to production and begin the process of switching the event tracking over to it.</p><h2 id="7-prepare-the-data-pipelines">7. Prepare the data pipelines</h2><p>Before we could switch the traffic, we had to make some changes to the Spark Data Pipeline so it could process the events from the old Event Hub and the new Event Hub deployments.</p><h2 id="8-switch-clients">8. Switch Clients</h2><p>Now we could switch over the event tracking. We had identified ~40 different services/clients sending events to Event Hub. Each one needed to be updated to point to the new infrastructure. We started with the clients with the lowest priority and/or least critical events first. This allowed us to validate the full end-to-end flow while minimizing the risk if we did hit a problem. It took about 6 weeks to switch over all the clients and lots of coordination with different engineering teams.</p><h2 id="9-success">9. Success</h2><p>By August 2023 we had migrated to the new deployment and were processing ~3.5 billion events per day. We had successfully switched to the new Event Hub deployment and not lost a single event or caused any delays to the data we deliver to the downstream use cases.</p><h1 id="the-lessons-we-learned">The lessons we learned</h1><p>During the migration we learned a few valuable lessons:</p><ul><li><strong><strong>Make your work visible</strong></strong></li></ul><p>When many teams, streams, and stakeholders are involved, you must be transparent about the work in progress and what has been completed.</p><ul><li><strong><strong>Individuals reaching out made a big difference</strong></strong></li></ul><p>While we aligned on expectations and priorities, we hit the inevitable problem that teams had conflicting priorities, deadlines, etc. We found out that individuals reaching out to people made a big difference. We were able to provide the context and specific help to each of the teams to help the work to be completed faster.</p><ul><li><strong><strong>Bake in event quality from the beginning</strong></strong></li></ul><p>If you&#x2019;re starting from scratch, then make event quality a first class concern from the beginning. Going back and adding it was much more difficult and carried more risk.</p><ul><li><strong><strong>Lean on internal tooling</strong></strong></li></ul><p>A lot of the machinery that allowed us to pull this off was available because of the excellent work other teams in Miro did. Event Hub evolved from being directly exposed to the public internet through a simple load balancer to benefitting from state of the art scalable infrastructure and DDoS protection.</p>]]></content:encoded></item><item><title><![CDATA[Big Data LDN 2019: Taking control of user analytics with Snowplow]]></title><description><![CDATA[<figure class="kg-card kg-embed-card"><iframe width="612" height="344" src="https://www.youtube.com/embed/-gMuC1LCY50?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure><p>User analytics is well established at Auto Trader but breakthroughs in the cloud, big data and streaming technologies offer clear benefits above and beyond what we could do today. This talk describes how we migrated to Snowplow on Google Cloud for our user-analytics platform. Snowplow is an event streaming pipeline</p>]]></description><link>http://www.dorzey.net/2019/12/16/big-data-ldn-2019-taking-control-of-user-analytics-with-snowplow/</link><guid isPermaLink="false">5f122464a8c34d000108b31f</guid><category><![CDATA[My Talks]]></category><category><![CDATA[Big Data]]></category><category><![CDATA[Analytics]]></category><dc:creator><![CDATA[Paul Doran]]></dc:creator><pubDate>Mon, 16 Dec 2019 12:00:00 GMT</pubDate><media:content url="http://www.dorzey.net/content/images/2020/07/tmp-2.png" medium="image"/><content:encoded><![CDATA[<figure class="kg-card kg-embed-card"><iframe width="612" height="344" src="https://www.youtube.com/embed/-gMuC1LCY50?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure><img src="http://www.dorzey.net/content/images/2020/07/tmp-2.png" alt="Big Data LDN 2019: Taking control of user analytics with Snowplow"><p>User analytics is well established at Auto Trader but breakthroughs in the cloud, big data and streaming technologies offer clear benefits above and beyond what we could do today. This talk describes how we migrated to Snowplow on Google Cloud for our user-analytics platform. Snowplow is an event streaming pipeline that provides many features such as a unified log of your users, event enrichments and a schema registry to enforce data integrity. I&apos;ll walk through why we chose to migrate, the overall Snowplow platform, the architectural benefits and how using Google BigQuery and DataFlow has been a huge success for Auto Trader.</p>]]></content:encoded></item><item><title><![CDATA[Continuous deployment of machine learning models]]></title><description><![CDATA[<figure class="kg-card kg-embed-card"><iframe width="612" height="344" src="https://www.youtube.com/embed/wnx5yYVf2hQ?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure><p> This talk describes how Auto Trader launched a suite of new machine learning models with the ability serve low-latency predictions in real time. These models are automatically retrained and redeployed using continuous deployment pipelines in our existing deployment infrastructure, making use of technology including Apache Spark, Airflow, Docker and Kubernetes.</p>]]></description><link>http://www.dorzey.net/2019/05/16/continuous-deployment-of-machine-learning-models/</link><guid isPermaLink="false">5f122426a8c34d000108b315</guid><category><![CDATA[My Talks]]></category><category><![CDATA[ML]]></category><category><![CDATA[Big Data]]></category><dc:creator><![CDATA[Paul Doran]]></dc:creator><pubDate>Thu, 16 May 2019 12:00:00 GMT</pubDate><media:content url="http://www.dorzey.net/content/images/2020/07/tmp-1.png" medium="image"/><content:encoded><![CDATA[<figure class="kg-card kg-embed-card"><iframe width="612" height="344" src="https://www.youtube.com/embed/wnx5yYVf2hQ?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></figure><img src="http://www.dorzey.net/content/images/2020/07/tmp-1.png" alt="Continuous deployment of machine learning models"><p> This talk describes how Auto Trader launched a suite of new machine learning models with the ability serve low-latency predictions in real time. These models are automatically retrained and redeployed using continuous deployment pipelines in our existing deployment infrastructure, making use of technology including Apache Spark, Airflow, Docker and Kubernetes. Since models are deployed without manual intervention, we developed a robust testing strategy to ensure deployments will not cause a drop in model performance, including accuracy and coverage.</p>]]></content:encoded></item><item><title><![CDATA[How we use Architectural Decision Records (ADRs) on Data Engineering]]></title><description><![CDATA[<p>When I joined our data engineers over a year ago they had already adopted Architectural Decision Records (ADRs) to document architectural decisions made whilst building Auto Trader&#x2019;s Data Platform. ADRs are listed in ThoughtWorks&#x2019; <a href="https://www.thoughtworks.com/radar/techniques/lightweight-architecture-decision-records">Technology Radar</a> as a technique to adopt; our data engineers were the first</p>]]></description><link>http://www.dorzey.net/2019/03/20/how-we-use-architectural-decision-records-adrs-on-data-engineering/</link><guid isPermaLink="false">5f122507a8c34d000108b32b</guid><category><![CDATA[Ways Of Working]]></category><dc:creator><![CDATA[Paul Doran]]></dc:creator><pubDate>Wed, 20 Mar 2019 12:00:00 GMT</pubDate><media:content url="http://www.dorzey.net/content/images/2020/07/tmp-3.png" medium="image"/><content:encoded><![CDATA[<img src="http://www.dorzey.net/content/images/2020/07/tmp-3.png" alt="How we use Architectural Decision Records (ADRs) on Data Engineering"><p>When I joined our data engineers over a year ago they had already adopted Architectural Decision Records (ADRs) to document architectural decisions made whilst building Auto Trader&#x2019;s Data Platform. ADRs are listed in ThoughtWorks&#x2019; <a href="https://www.thoughtworks.com/radar/techniques/lightweight-architecture-decision-records">Technology Radar</a> as a technique to adopt; our data engineers were the first team I&#x2019;ve worked on to use them. They have allowed us to capture the context and consequences of the decisions we make; in a way that provides transparency and allows the whole team, and wider organisation, to contribute.</p><h2 id="what-is-an-adr">What is an ADR?</h2><p>ADRs are short text files that capture a single decision; see <a href="http://thinkrelevance.com/blog/2011/11/15/documenting-architecture-decisions">here</a> for a more in-depth description. The ADRs are numbered sequentially and monotonically; with no number reused.</p><p>We have adopted the below convention for our ADRs:</p><ul><li><strong>Title</strong>: A descriptive title in the following format: <code>&lt;ADR_ID - &lt;Title&gt;</code></li><li><strong>Status</strong>: It must have one of the below statuses.</li></ul><figure class="kg-card kg-image-card"><img src="http://engineering.autotrader.co.uk/images/2019-03-20/adr_state_diag.svg" class="kg-image" alt="How we use Architectural Decision Records (ADRs) on Data Engineering" loading="lazy"></figure><p>ADRs can only change status along the permitted transitions shown in the diagram above.</p><ul><li><strong>Context</strong>: The facts about why we need to make this decision. For example, they could be technological, such as we need to provide a certain capability; or they could be legal, such as compliance requirements.</li><li><strong>Decision</strong>: The actual decision. We provide a description of what we decided and provide justifications if needed. The decision should be an action we will undertake.</li><li><strong>Consequences</strong>: We provide a description of all the potential consequences; be they good, bad or neutral.</li></ul><h2 id="how-are-adrs-used-in-data-engineering">How are ADRs used in Data Engineering?</h2><p>Our data engineers maintain a website in <a href="https://jekyllrb.com/docs/github-pages/">GitHub Pages using Jekyll</a>. This was already used to share common links, jargon bust and build statuses - so the ADRs were placed there too. The squad website is readable by anyone at Auto Trader and contributions are welcome from anyone.</p><p>There are ADRs covering a wide range of subjects; how to partition data in the data lake, choice of business intelligence tool, proposed changes to metric algorithms, etc.</p><p>Having a place to record the ADRs is not enough. Consensus needs to be reached on whether ADRs should change status or not. We either address this at standup or with specific meetings for more in-depth discussions.</p><p>As the Data Platform was built lots of architectural decisions were made. We&#x2019;ve found it worthwhile revisiting the decisions and see if they still hold; given <a href="https://engineering.autotrader.co.uk/2018/11/21/lessons-from-the-data-lake-architectural-decisions.html">what we&#x2019;ve learnt</a> as the platform grows.</p><h3 id="benefits-of-adrs">Benefits of ADRs</h3><h4 id="one-clearly-reasoned-decisions">One: Clearly reasoned decisions</h4><p>The format of the ADRs enforces consistency in approach to documenting decisions. This makes it easier for both the author and the reader. The author knows what information to provide to produce an ADR, and the reader knows what to expect when reading an ADR and where to find it.</p><p>As the Data Platform is being built new technology is continuously adopted. The ADRs allow us to show stakeholders that we are in control of technology adoption and change.</p><h4 id="two-good-for-new-team-members">Two: Good for new team members</h4><p>I found the ADRs invaluable when I first joined Data Engineering. They allowed me to get up to speed quickly on why the team had made certain decisions. I could read the ADRs to gain a broad understanding of the architecture and to understand the context of the decision. The ADRs told me the history of the decisions made by Data Engineering.</p><h4 id="three-version-control-for-the-history-of-team-decisions">Three: Version control for the history of team decisions</h4><p>Given we are using GitHub Pages to store our ADRs we get a versioned history of their changes for free. I have found it useful to review the history of an ADR to understand its evolution or to know who to ask for clarification if something is unclear.</p><h4 id="four-keeping-them-lightweight">Four: Keeping them lightweight</h4><p>We don&#x2019;t embrace &#x2018;big design up front&#x2019; so the ADRs are not mammoth documents that nobody will ever read. The theme used for Jekyll has a built-in reading time estimator; the longest ADR to date has an estimated reading time of 4 minutes.</p><h3 id="challenges-of-adrs">Challenges of ADRs</h3><h4 id="one-deciding-when-to-create-one">One: Deciding when to create one</h4><p>There are no defined rules for when to create an ADR. Individuals are free to propose an ADR when they feel one is necessary. The hope being that by doing this we are capturing all the ADRs needed. I think over time, and with experience, we&#x2019;ve gotten better at ensuring ADRs are written when required. There have been only a few occasions where I have felt that an ADR was missed.</p><h4 id="two-keeping-them-up-to-date">Two: Keeping them up-to-date</h4><p>The environment our data engineers work in is reasonably fast paced and lots of decisions can get made in a short space of time. I have found, on occasion, that the ADRs are out of date.</p><p>If we fail to write them in a timely manner then we reduce the value of the ADRs; future potential readers have no way of knowing what was not recorded. This was one of the reasons we now have semi-regular catch-ups to discuss ADRs.</p><h4 id="three-keeping-them-lightweight">Three: Keeping them lightweight</h4><p>The preference for keeping the ADRs lightweight can make them challenging to write. When writing an ADR you want to provide enough information to a future reader, but do it in a concise way. This requires good clear writing; which isn&#x2019;t the easiest thing to achieve when documenting a detailed technical decision.</p><h2 id="conclusions">Conclusions</h2><p>We&#x2019;ve found great value in ADRs as both a historical record of decisions and a way to capture the thinking behind architectural choices. Their number continues to grow.</p><p>They were incredibly useful to me when I first joined and I continue to find them a valuable tool.</p>]]></content:encoded></item></channel></rss>